<section id="projekte" class="py-20 my-8 bg-opacity-50 border-t-2 border-b-2 lg:my-12 bg-brown-100 border-brown-900">
  <header class="px-4 mx-auto">
    <h2 class="text-2xl font-extrabold md:text-3xl lg:text-4xl md:text-center">
    Referenzprojekte & Kundenstimmen
    </h2>
    <p class="mx-auto mt-2 text-lg text-gray-600 md:text-center max-w-prose">Wir stellen vor: Großaufträge, die besonders viele unserer Leistungen in Anspruch nehmen, oder aber Projekte, die die handwerkliche Begabung unserer Mitarbeiter besonders herausstellem. Wir aktualisieren diese Projekte regelmäßig. </p>
  </header>

  <div class="px-4 mx-auto mt-4 divide-y-2 md:divide-y-0 md:mt-12 max-w-default divide-brown-900">

    <!-- Container for projects -->
    
    {% for item in featured %}
      <article class="flex flex-wrap items-start py-16 md:flex-nowrap md:space-x-8 md:even:flex-row-reverse md:even:space-x-reverse" 
      x-data="{i:{{loop.index}} }" 
      x-intersect.once="window.parent.gallery(i)">

        {# ! (i%2)==1 gives true or false if i is odd ===================== #}
        {# Content of the presented project ======================= #}
        {# ======================================================== #}
        <div class="flex-auto p-4 pb-12 -m-2 bg-white rounded-md shadow-lg md:flex-1 md:p-8 md:-my-6"        
        :class="(i% 2) == 1 ? 'md:pr-16  md:-ml-6 md:-mr-16' : 'md:pl-16 md:-mr-6 md:-ml-16'">

          <!-- Project Description -->
          <div>
            <h2 class="text-2xl font-bold">{{item.headline}}</h2>
            <p class="mt-2 text-gray-600">{{item.excerpt}}</p>
          </div>

          <!-- Features of the project -->
          <ul class="mt-6 space-y-2">

            {% for item in item.features %}
              <li class="flex space-x-2 md:space-x-4 items-top">
                <div class="flex items-start flex-1 text-sm font-medium lg:text-base">
                  <span>›</span>
                  <p class="ml-1">{{item}}</p>
                </div>
              </li>
            {% endfor %}
          </ul>          
          
          {# Kundenrezension, falls vorhanden ===================== #}
          {% if item.customerName %}
          <div class="mt-12 text-sm md:text-base">
            <div class="md:flex md:flex-nowrap">
              <svg class="w-6 h-6 mx-auto md:mx-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"></path></svg>
              <p class="ml-2 font-semibold text-center">{{item.customerName}} | {{item.customerPosition}}</p>
            </div>
            <p class="mt-2 italic">" {{item.customerReview}} "</p>
          </div>
          {% endif %}

        </div>

        {# Slider  of the presented project ========================= #}
        {# ======================================================== #}
        <div class="flex-auto w-full md:flex-1 ">
          <div class="splide  primary-slider-{{loop.index}}">
            <div class="splide__track">
              <ul class="splide__list">
                {% for item in item.images %}
                  <li class="splide__slide">
                    <div class="aspect-w-4 aspect-h-3 ">
                      <img class="object-cover w-full h-full overflow-hidden rounded-lg" src="{{item}}" alt="Ein Bild"/>
                    </div>
                  </li>
                  {%endfor%}
              </ul>
            </div>
          </div>
          <div class="mt-1 splide secondary-slider-{{loop.index}}">
            <div class="splide__track">
              <ul class="splide__list">
              {% for item in item.images %}
                <li class="splide__slide">
                <div class="aspect-w-4 aspect-h-3">
                  <img class="object-cover w-full h-full overflow-hidden rounded-md" src="{{item}}" alt="Ein Bild"/>
                  </div>
                </li>
                {%endfor%}           
              </ul>
            </div>
          </div>
        </div>

      </article>
    {% endfor %}

  </div>

</section>

<script type="module">
  
 var gallery = function(i) {
    var secondarySlider = new Splide('.secondary-slider-'+i, {
      fixedWidth: 96,
      gap: 10,
      cover: true,
      arrows: false,
      isNavigation: true,
      focus: 'center',
      breakpoints: {
        '600': {
          fixedWidth: 66,
          gap:4
        }
      }
    }).mount();
    
    var primarySlider = new Splide('.primary-slider-'+i, {
      type: 'fade',
      width: '100%',
      pagination: false,
      lazyLoad: "nearby",
      arrows: false,
      cover: true
    }); // do not call mount() here.

    primarySlider
      .sync(secondarySlider)
      .mount();
  }

  window.gallery = gallery;
</script>